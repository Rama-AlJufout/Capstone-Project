{% extends 'base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/journal/journal.css' %}">
{% endblock %}

{% block content %}
<!-- ===== Image Background ===== -->
<div class="bg-image">
  <img src="{% static 'images/jo-bg.avif' %}" alt="Background">
  <div class="overlay"></div>
</div>
<div class="journal-wrapper">
  {% if journals %}
    <!-- ===== Journal History ===== -->
    <div class="history-container">
      <h2 class="journal-header">My Journal</h2>
      <div class="journal-cards">
        {% for entry in journals %}
        <div class="journal-card glass-card">
          <h3>{{ entry.mood|capfirst }}</h3>
          <p>{{ entry.note|linebreaksbr }}</p>
          <p><small><strong>Date:</strong> {{ entry.date|date:"M. d, Y" }}</small></p>

          <!-- ===== Action Buttons ===== -->
          <div class="confirm-actions">
            <a href="{% url 'journal_update' entry.id %}" class="edit-btn">Edit</a>
            <a href="#delete-{{ entry.id }}" class="delete-btn">Delete</a>
          </div>
        </div>

        <!-- ===== Delete Confirmation Modal ===== -->
        <div id="delete-{{ entry.id }}" class="confirm-delete-container">
          <div class="confirm-card glass-card">
              <h2>Confirm Delete</h2>
              <p>Are you sure you want to delete this journal entry?</p>
              <div class="confirm-actions">
                  <form method="POST" action="{% url 'journal_delete' entry.id %}">
                      {% csrf_token %}
                      <button type="submit" class="delete-btn">Yes, Delete</button>
                  </form>
                  <a href="#" class="cancel-btn">Cancel</a>
              </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- ===== Add New Journal Form ===== -->
    <div class="form-container glass-card">
      <h2>Add New Journal Entry</h2>
      <form method="POST">
        {% csrf_token %}
        {{ form.non_field_errors }}

        <div class="form-group">
          {{ form.mood.label_tag }}
          {{ form.mood }}
        </div>

        <div class="form-group">
          {{ form.note.label_tag }}
          {{ form.note }}
        </div>

        <div class="form-group">
          {{ form.date.label_tag }}
          {{ form.date }}
        </div>

        <button type="submit">Add Entry</button>
      </form>
    </div>

  {% else %}
    <!-- ===== No Journals Yet: Show Form First ===== -->
    <div class="form-container glass-card">
      <h2>Create Your First Journal Entry</h2>
      <form method="POST">
        {% csrf_token %}
        {{ form.non_field_errors }}

        <div class="form-group">
          {{ form.mood.label_tag }}
          {{ form.mood }}
        </div>

        <div class="form-group">
          {{ form.note.label_tag }}
          {{ form.note }}
        </div>

        <div class="form-group">
          {{ form.date.label_tag }}
          {{ form.date }}
        </div>

        <button type="submit">Add Entry</button>
      </form>
    </div>
  {% endif %}

</div>
{% endblock %}
