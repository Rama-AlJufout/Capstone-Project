{% extends 'base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/activity/activity.css' %}">
{% endblock %}

{% block content %}

<!-- ===== Video Background ===== -->
<div class="video-bg">
    <video autoplay muted loop id="bg-video">
        <source src="{% static 'videos/bg.mp4' %}" type="video/mp4">
    </video>
    <div class="overlay"></div>
</div>

<div class="activity-wrapper">

  {% if activities %}
    <!-- ===== Activity History ===== -->
    <div class="history-container">
      <h2 class="history-header">Activity History</h2>
      <div class="activity-cards">
        {% for activity in activities %}
        <div class="activity-card">
          <a href="{% url 'activity_update' activity.pk %}" class="activity-link">
            <h3>{{ activity.get_activity_type_display }}</h3>
            <p><strong>Duration:</strong> {{ activity.duration_minutes }} minutes</p>
            <p><strong>Calories Burned:</strong> {{ activity.calories_burned }} kcal</p>
            <p><strong>Date:</strong> {{ activity.date|date:"M. d, Y" }}</p>
          </a>

          <!-- ===== Action Buttons ===== -->
          <div class="activity-actions">
            <a href="{% url 'activity_update' activity.pk %}" class="edit-btn">Edit</a>
            <a href="#confirm-delete-{{ activity.pk }}" class="delete-btn">Delete</a>
          </div>
        </div>

        <!-- ===== Delete Confirmation Modal ===== -->
        <div id="confirm-delete-{{ activity.pk }}" class="confirm-delete-container">
          <div class="confirm-card">
              <h2>Confirm Delete</h2>
              <p>Are you sure you want to delete this activity?</p>
              <div class="confirm-actions">
                  <form action="{% url 'activity_delete' activity.pk %}" method="POST">
                      {% csrf_token %}
                      <button type="submit" class="delete-btn">Yes, Delete</button>
                  </form>
                  <a href="#" class="edit-btn">Cancel</a>
              </div>
          </div>
        </div>

        {% endfor %}
      </div>
    </div>

    <!-- ===== New Activity Form ===== -->
    <div class="form-container glass-card">
      <h2>Log New Activity</h2>
      <form method="POST">
        {% csrf_token %}
        {{ form.non_field_errors }}

        <div class="form-group">
          {{ form.activity_type.label_tag }}
          {{ form.activity_type }}
        </div>

        <div class="form-group">
          {{ form.start_time.label_tag }}
          {{ form.start_time }}
        </div>

        <div class="form-group">
          {{ form.end_time.label_tag }}
          {{ form.end_time }}
        </div>

        <div class="form-group">
          {{ form.calories_burned.label_tag }}
          {{ form.calories_burned }}
        </div>

        <button type="submit">Add Activity</button>
      </form>
    </div>

  {% else %}
    <!-- ===== No Activities: Show Form First ===== -->
    <div class="form-container glass-card">
      <h2>Log Your First Activity</h2>
      <form method="POST">
        {% csrf_token %}
        {{ form.non_field_errors }}

        <div class="form-group">
          {{ form.activity_type.label_tag }}
          {{ form.activity_type }}
        </div>

        <div class="form-group">
          {{ form.start_time.label_tag }}
          {{ form.start_time }}
        </div>

        <div class="form-group">
          {{ form.end_time.label_tag }}
          {{ form.end_time }}
        </div>

        <div class="form-group">
          {{ form.calories_burned.label_tag }}
          {{ form.calories_burned }}
        </div>

        <button type="submit">Add Activity</button>
      </form>
    </div>
  {% endif %}

</div>
{% endblock %}
